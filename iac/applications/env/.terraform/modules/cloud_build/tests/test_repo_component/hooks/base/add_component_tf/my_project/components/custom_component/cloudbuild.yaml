steps:

  - name: "gcr.io/cloud-builders/docker"
    dir: "${_PROJECT_ROOT}/components/custom_component"
    entrypoint: bash
    args:
      - "-c"
      - |
        branch_name=$BRANCH_NAME
        branch=${branch_name//\//-}
        docker build -t ${_ARTIFACT_REGISTRY_CONTAINERS_URL}/custom_component:latest -t ${_ARTIFACT_REGISTRY_CONTAINERS_URL}/custom_component:$SHORT_SHA -t ${_ARTIFACT_REGISTRY_CONTAINERS_URL}/custom_component:$branch --network=cloudbuild .

  - name: 'gcr.io/cloud-builders/docker'
    dir: "${_PROJECT_ROOT}/components/custom_component"
    entrypoint: docker
    args: [
      "push",
      "-a",
      "${_ARTIFACT_REGISTRY_CONTAINERS_URL}/custom_component",
    ]
